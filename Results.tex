\input{preamble}
\newcommand{\lre}{\color{red}{\{}}
\usepackage{multirow, booktabs}
\begin{document}
\subsection{Actual Results}
\section*{Results}
\begin{table}
\centering
\begin{tabular}{l|r@{ / }r@{ / }r|r@{ / }r@{ / }r|r@{ / }r@{ / }r|rr}
\toprule
$\multirow{2}{*}{Model}$&\multicolumn{3}{c|}{Original size}&\multicolumn{3}{c|}{Original, presolved}& \multicolumn{3}{c|}{Projected size}&\multicolumn{2}{c}{Time}\\
&\#ineqs (\#eqs)&\#vars&\#nzs&\#rows&\#cols&\#nzs&\#ineqs&\#vars&\#nzs&decomp.&flat\\
\midrule
%\multirow{2}{*}
{No weights} &774(12)&1142&6662&	554&657&2784&				20&12&155&24m 36s&2m 30s (and it's smaller)\\
%\multirow{2}{*}
{No hydrostatics} &806(43)&1173&7854&	555&657&3441&		14&12&104&4h 35m 59s&1m 48s (!) (and it's smaller)\\
%\multirow{2}{*}
{2 parts} &810(43)&1173&7860&	556&661&3447&						96&12&1113&7h 17m 59s&TO 32 h, 563 vars left\\
%\multirow{2}{*}
%7{3 parts B} &&&&	561&667&3461&						&&& & \\
%{3 parts} &818(47)&1177&7874&	561&667&3461&						43&12&469&way too long&TO. 65h 30m (554 vars left) \\
%\multirow{2}{*}
{4 parts} &824(49)&1179&7886&	564&671&3471&	64&12&731&8h 4m 0s&\\
%\multirow{2}{*}
{6 parts} &838(55)&1185&7916&	570&679&3496&	80&12&888&3h 7m 0s&TO (18 h, 589 vars left)\\
{8 parts} &852(61) &1191 &7950	&	576&685&3522&	52 &12&582&4h 39m 8s &\\
\bottomrule
\end{tabular}
\caption{Size of projections}
\label{tab:projections}
\end{table}



%3 partsB:
%\begin{align*}
%\Bigg\{\bigg\{\Big\{\big\{\{1,2,3\}\big\},\big\{\{4,5\},\{6\}\big\}\Big\},\Big\{\big\{\{7\},\{8,9\}\big\}\Big\},LH\bigg\},\\
%\bigg\{\Big\{\big\{\{10,11\},\{12,13\}\big\},\big\{\{14,15\},\{16,17\}\big\}\Big\}\bigg\},\\
%\bigg\{\Big\{\big\{\{18,19\},\{20\}\big\}\Big\},\Big\{\big\{\{21\},\{22,23\}\big\},\big\{\{24,25,26\}\big\}\Big\},RH\bigg\}\Bigg\}
%\end{align*}

4 parts
\begin{align*}
\Bigg\{\bigg\{\Big\{\big\{\{1,2,3\},\{4,5\}\big\},\big\{\{6,7\}\big\}, LH\Big\},\Big\{\big\{\{8,9\}\big\},\big\{\{10,11\},\{12,13\}\big\}\Big\}\bigg\},\\
\bigg\{\Big\{\big\{\{14,15\},\{16,17\}\big\},\big\{\{18,19\}\big\}\Big\},\Big\{\big\{\{20,21\},\{22,23\}\big\},\big\{\{24,25,26\}\big\}, RH\Big\}\bigg\}\Bigg\}
\end{align*}

6 parts:
\begin{align*}
\Bigg\{\bigg\{\Big\{\big\{\{1,2,3\},\{4,5\}\big\},\big\{\{6,7\},\{8,9\}\big\}, LH\Big\},\Big\{\big\{\{10,11\},\{12,13\}\big\}\Big\}\bigg\},
\\
\bigg\{\Big\{\big\{\{14,15\},\{16,17\}\big\},\big\{\{18,19\},\{20,21\}\big\}\Big\},\Big\{\big\{\{22,23\},\{24,25,26\}\big\}\Big\}\bigg\}\Bigg\}
\end{align*}

8 parts:
\begin{align*}
\Bigg\{\Bigg\{\bigg\{\Big\{\{1,2,3\}\Big\},\Big\{\{4,5\},\{6\}\Big\}\bigg\},\bigg\{\Big\{\{7\},\{8,9\}\Big\},\Big\{\{10,11\},\{12,13\}\Big\}\bigg\},LH\Bigg\},\\
\Bigg\{\bigg\{\Big\{\{14,15\},\{16,17\}\Big\},\Big\{\{18,19\},\{20\}\Big\}\bigg\},\bigg\{\Big\{\{21\},\{22,23\}\Big\},\Big\{\{24,25,26\}\Big\}\bigg\},RH\Bigg\}\Bigg\}
\end{align*}


%\[
%1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26
%\]

%\begin{table}
%\centering
%\begin{tabular}{lr|r|r}
%\toprule
%Model&$$&Projected&Original\\
%\midrule
%\multirow{2}{*}{No weights} &Time&&363(92) / 2.64\\
%&Objective&&$8.0802\cdot 10^6$\\
%\midrule
%\multirow{2}{*}{No hydrostatics} &Time&&\\
%&Objective&\\
%\midrule
%\multirow{2}{*}{2 parts} &Time&&\\
%&Objective&\\
%\midrule
%\multirow{2}{*}{3 parts} &Time&&\\
%&Objective&&\\
%\midrule
%\multirow{2}{*}{4 parts} &Time&13(0) / 0.18&228(5) / 4.95\\
%&Objective&$6.16792\cdot 10^6$&$6.1585\cdot 10^6$\\
%\midrule
%\multirow{2}{*}{6 parts} &Iterations/ticks&9(0) / 0.20&227(7) / 5.02\\
%&Objective& $6.17168\cdot 10^6$&$6.1842\cdot 10^6$\\
%\midrule
%\multirow{2}{*}{8 parts} &Iterations/ticks &12(0) / 0.14&233(9) / 4.79\\
%&Objective& $6.2076\cdot 10^6$&$6.17735\cdot 10^6$\\
%\bottomrule
%\end{tabular}
%\caption{Accuracy and time for models used in flow network/transshipment graph. }
%\label{tab:usingProjections}
%\end{table}

Optimizing revenue for each of the models. Revenue is based on size, weight and refer-property of the conatiner types. More specifically, [reefer containers make the double revenue as a similar non-reefer container, 40' containers have a revenue which is 1.5 times higher as a similar 20' conatiner, while containers are more expensive the heavier it is (but more than linearly)]. [For a 20', non-reefer, with a weight, respectively of 6, 21 and 27 t, the revenue is, respectively 100, 600 and 700 \$.]   
\begin{table}
\centering
\begin{tabular}{l|rrr|rrr|rrr}
\toprule
Model&\multicolumn{3}{c|}{Projected}&\multicolumn{3}{c}{Original}&\multicolumn{3}{c}{Difference}\\
&Iterationer&Ticks&Objective&Iterations&Ticks&Objective&It. (\%)&Ticks(\%)&Obj.(\%)\\
\midrule
No weights&	11(0) & 0.05 & $8.6318\cdot 10^6$ &	363(92) & 2.64&$8.0802\cdot 10^6$
&96.97&98.12&6.83\\
\midrule
{No hydrostatics}& 7(0) & 0.03 &$6.2217\cdot 10^6$&	188(1) & 5.48&$6.2215 \cdot 10^6$
&96.28&99.45&0.0032\\
\midrule
{2 parts}& 14(0) & 0.29 & $6.0862\cdot 10^6$ &	251(2) & 5.88&$6.0743\cdot 10^6$
&94.42&95.07&0.1959\\
\midrule
%{3 parts B}&    &&&	230(4) & 5.46&$6.2096\cdot 10^6$
%&&\\
%{3 parts}&	11(0) & 0.12 &$6.2262\cdot 10^6$&	227(4) & 5.18&$6.2188\cdot 10^6$
%&&\\
%\midrule
{4 parts} &13(0) & 0.18 &$6.1679\cdot 10^6$ & 228(5) & 4.95 &$6.1585\cdot 10^6$
&94.30&96.36&0.1526\\
\midrule
{6 parts} &9(0) & 0.20& $6.1717\cdot 10^6$ &227(7) & 5.02 &$6.1842\cdot 10^6$
&96.04&96.02&0.2021\\
\midrule
{8 parts} &12(0) & 0.14& $6.2076\cdot 10^6$ & 233(9) & 4.79 &$6.17735\cdot 10^6$
&94.85&97.08&0.4897\\
\bottomrule
\end{tabular}
\caption{Time and results for projected and unprojected models }
\label{tab:usingProjections}
\end{table}
Conlusions: 
The projected models have much fewer number of inequalities and variables (app. 6 - 40 times fewer inequalities and 55-57 times fewer variables), and also fewer non-zero entries (though, the projected models are more dense [me thinks]).

There si no apparent relationsship between the ``complexity''/size of the model and the final size of the projection, which probably have to do with both the actual division made of the ship and the undeterministic behaviour of the removal of ``almost redundant'' inequalities. 

In general, projections are much faster than the unprojected models (the difference being between 94 and 97 \% of the number of iterations, and 96 and 99.5 \% cplex ``ticks'', respectively), while the difference is only modest (for the models including weight, it is less than ½ percent difference). For most of the models, the objective is bigger - allowing more than it should, except for the model with a 6 part division, which allows less [does that mean, there was a mistake, or is this theoretically possible. I think it is possible.] 


\subsection*{Projection af SVMs}
For a number of vessels for which we have the required data, we have created/constructed/... Standard Vessel Models for various sections. [The vessels and their different partitions into sections [actually rather the number of sections] appears in Tables~\ref{tab:projections}]. 
%Note to self: Det her skal jo så helst stemme overens med de data, jeg påstår, vi har, når jeg beskriver modellen. 

Each SVM has been projected, such that only the variables denoting the number of each type of containers is left, that is, all variables but $\set{y_\tau}{\tau\in T}$ [eller hvad de nu hedder] are eliminated. 
For this, the model has either been projected \emph{flat}, that is, all required variables are eliminated from the system as presented in Section~\ref{sec:SVM}, or the SVM has been decomposed using a tree structure as described in Section~\ref{sec:decomp}. [The particular used decompositions can be found in the appendix]. In these cases, the decomposition makes the projection doable, while a flat decomposition causes a too long execution time and/or memory usage under the given testing conditions. The time limit was set to a generous ... hours while ... was set to ... . 
It should be mentioned that it is possible, that other orderings of the variables (caused by other heuristics then the used greedy heuristic) in these cases could potentially lead to doable/manageable flat projections, but testing this is outside the scope of this paper.  
[It should likewise be mentioned that the runtimes, even for the decomposed projections, are not exactly small... The main part of the execution time is spend doing redundancy removal. Figure~\ref{..}(a) shows the evolution of the number of inequalities during the execution of the procedure ([... something with adding the inequalities in subsystems still left to be projected, to the subsystem being projected]), while Figure~\ref{..}(b) shoes the corresponding time ([summeret or for each step?]). 

The projections were done on a ... computer with ... .
The SVMs projected are summarized in Table~\ref{tab:projections}. This table also shows the sizes of the SVMs as well as their projections, given as the number of inequalities in the system, the number of variables, and the density of the system.  
\begin{table}
\centering
\begin{tabular}{lrl|r@{ / }r@{ / }r|r@{ / }r@{ / }r}
\toprule
\multirow{2}{*}{Vessel}&$\multirow{2}{*}{|S|}$&\multirow{2}{*}{Structure}&\multicolumn{3}{c|}{Size of SVM}& \multicolumn{3}{c}{Projected size}\\
&&&\#ineqs&\#vars&density&\#ineqs&\#vars&density\\
\midrule
\multirow{3}{*}{Emma}& {4} & flat &72&75&5.52&&&\\
&{6} & decomp. &104&108&5.82&64&12&11.9\\
&{8} & decomp. &136&138&5.92&62&12&11.9\\
\midrule
\multirow{2}{*}{V402}& {6} & flat &104&108&5.76&&&\\
& {8} & decomp. &&&&&&\\
\midrule
\multirow{2}{*}{V546}& {4} & flat &&&&&&\\
& {5} & decomp. &88&92&5.65&&&\\
\midrule
{V614}& {4} & [flat] &72&74&5.52&2&12&2\\
\bottomrule
\end{tabular}
\caption{Projections of a SVM for x vessels. [Potentially also with parallel main, though I am not sure this helps, given the data.]}
\label{tab:projections}
\end{table}
[I guess the point is that it is possible, not that it is fast, and it should have been argued earlier that the projections themselves are valuable. Further, it would be nice, if the size actually is (a lot) smaller, but I am not really sure it is... Otherwise, we could (maybe) compare to the original capacity model (with locations), i.e. before we make the standard model].

[Potentially also make a table showing that the decompositions are neccessary, i.e. that the flat model runs out of memory (how far in the process) or that it runs out of time (problem: the decomposition of Emma-8 takes 6 days and a bit, so it will at least take that long for it to run out of time...)]

[Hm, Rune would probably like some graphs showing the development of the number of inequalities during the execution - that even though it explodes, kind of, it mostly gets smaller again.]

  

\subsection*{Using projections}
Question: Under the assumption that the vessel is loaded with cargo in a valid configuration such that the utilization (or the revenue) is within 5 \% of the maximal value, what is the upper and lower bound (TEU) of each of the different types of containers?
These values are obviously found by first finding the optimal value ( m = max \# TEU subject to stowage model constraints),
and then -- for each type $\tau\in T$ -- maximizing, respectively minimizing, $y^\tau$ (whatever I called it) under the same constraints with the further constraint that \# TEU <= 0.95* m.  

The table below shows the total time taken to find those upper and lower bounds for each type $\tau\in T$ after the maximal value has been found. The value is an average over $10$ executions. 
%Note to self: When you do this, also record the the actual results, so that I can compare it with model

\begin{table}
\centering
\begin{tabular}{lr|r|r}
\toprule
Vessel&$|S|$&Time SVM (ms)&Time projection (ms)\\
\midrule
\multirow{3}{*}{Emma}& 4&&\\
&6&&\\
&8&&\\
\midrule
\multirow{2}{*}{V402}&6&\\
&8&\\
\midrule
\multirow{2}{*}{V546}&4&\\
&5&\\
\bottomrule
\end{tabular}
\caption{The time used for finding bounds for all types in Standard Vessel Models and projections hereof, respectively, for x vessels. }
\label{tab:usingProjections}
\end{table}

\subsection*{Projection of other block-structured systems/Multicommodity flow graphs} 

\end{document}
